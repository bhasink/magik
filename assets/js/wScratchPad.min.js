!function(t){"use strict";function s(s,i){this.$el=t(s),this.options=i,this.init=!1,this.enabled=!0,this._generate()}s.prototype={_generate:function s(){return t.support.canvas?(this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),"static"===this.$el.css("position")&&this.$el.css("position","relative"),this.$img=$('<img src=""/>').css({position:"absolute",width:"100%",height:"100%"}),this.$scratchpad=t(this.canvas).css({position:"absolute",width:"100%",height:"100%"}),this.$scratchpad.bindMobileEvents(),this.$scratchpad.mousedown(t.proxy(function(s){return this.enabled?(this.canvasOffset=t(this.canvas).offset(),this.scratch=!0,void this._scratchFunc(s,"Down")):!0},this)).mousemove(t.proxy(function(t){this.scratch&&this._scratchFunc(t,"Move")},this)).mouseup(t.proxy(function(t){this.scratch&&(this.scratch=!1,this._scratchFunc(t,"Up"))},this)),this._setOptions(),this.$el.append(this.$img).append(this.$scratchpad),this.init=!0,void this.reset()):(this.$el.append("Canvas is not supported in this browser."),!0)},reset:function s(){var i=this,e=Math.ceil(this.$el.innerWidth()),h=Math.ceil(this.$el.innerHeight()),n=window.devicePixelRatio||1;this.pixels=e*h,this.$scratchpad.attr("width",e).attr("height",h),this.canvas.setAttribute("width",e*n),this.canvas.setAttribute("height",h*n),this.ctx.scale(n,n),this.pixels=e*n*h*n,this.$img.hide(),this.options.bg&&("#"===this.options.bg.charAt(0)?this.$el.css("backgroundColor",this.options.bg):(this.$el.css("backgroundColor",""),this.$img.attr("src",this.options.bg))),this.options.fg&&("#"===this.options.fg.charAt(0)?(this.ctx.fillStyle=this.options.fg,this.ctx.beginPath(),this.ctx.rect(0,0,e,h),this.ctx.fill(),this.$img.show()):t(new Image).attr("src",this.options.fg).load(function(){i.ctx.drawImage(this,0,0,e,h),i.$img.show()}))},clear:function t(){this.ctx.clearRect(0,0,Math.ceil(this.$el.innerWidth()),Math.ceil(this.$el.innerHeight()))},enable:function t(s){this.enabled=s===!0?!0:!1},destroy:function s(){this.$el.children().remove(),t.removeData(this.$el,"wScratchPad")},_setOptions:function t(){var s,i;for(s in this.options){this.options[s]=this.$el.attr("data-"+s)||this.options[s],i="set"+s.charAt(0).toUpperCase()+s.substring(1),this[i]&&this[i](this.options[s])}},setBg:function t(){this.init&&this.reset()},setFg:function t(){this.setBg()},setCursor:function t(s){this.$el.css("cursor",s)},_scratchFunc:function t(s,i){s.pageX=Math.floor(s.pageX-this.canvasOffset.left),s.pageY=Math.floor(s.pageY-this.canvasOffset.top),this["_scratch"+i](s),(this.options.realtime||"Up"===i)&&this.options["scratch"+i]&&this.options["scratch"+i].apply(this,[s,this._scratchPercent()])},_scratchPercent:function t(){for(var s=0,i=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height),e=0,h=i.data.length;h>e;e+=4){0===i.data[e]&&0===i.data[e+1]&&0===i.data[e+2]&&0===i.data[e+3]&&s++}return s/this.pixels*100},_scratchDown:function t(s){this.ctx.globalCompositeOperation="destination-out",this.ctx.lineJoin="round",this.ctx.lineCap="round",this.ctx.strokeStyle=this.options.color,this.ctx.lineWidth=this.options.size,this.ctx.beginPath(),this.ctx.arc(s.pageX,s.pageY,this.options.size/2,0,2*Math.PI,!0),this.ctx.closePath(),this.ctx.fill(),this.ctx.beginPath(),this.ctx.moveTo(s.pageX,s.pageY)},_scratchMove:function t(s){this.ctx.lineTo(s.pageX,s.pageY),this.ctx.stroke()},_scratchUp:function t(){this.ctx.closePath()}},t.support.canvas=document.createElement("canvas").getContext,t.fn.wScratchPad=function(i,e){function h(){var e=t.data(this,"wScratchPad");return e||(e=new s(this,t.extend(!0,{},i)),t.data(this,"wScratchPad",e)),e}if("string"==typeof i){var n,c=[],a=(void 0!==e?"set":"get")+i.charAt(0).toUpperCase()+i.substring(1),o=function t(){n.options[i]&&(n.options[i]=e),n[a]&&n[a].apply(n,[e])},r=function t(){return n[a]?n[a].apply(n,[e]):n.options[i]?n.options[i]:void 0},p=function s(){n=t.data(this,"wScratchPad"),n&&(n[i]?n[i].apply(n,[e]):void 0!==e?o():c.push(r()))};return this.each(p),c.length?1===c.length?c[0]:c:this}return i=t.extend({},t.fn.wScratchPad.defaults,i),this.each(h)},t.fn.wScratchPad.defaults={size:5,bg:"#cacaca",fg:"#6699ff",realtime:!0,scratchDown:null,scratchUp:null,scratchMove:null,cursor:"crosshair"},t.fn.bindMobileEvents=function(){t(this).on("touchstart touchmove touchend touchcancel",function(t){var s=t.changedTouches||t.originalEvent.targetTouches,i=s[0],e="";switch(t.type){case"touchstart":e="mousedown";break;case"touchmove":e="mousemove",t.preventDefault();break;case"touchend":e="mouseup";break;default:return}var h=document.createEvent("MouseEvent");h.initMouseEvent(e,!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),i.target.dispatchEvent(h)})}}(jQuery);